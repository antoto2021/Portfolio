<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Green Codex">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	
	<link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo appli.png">
    <link rel="icon" type="image/png" href="logo appli.png">
	
    <title>Green Codex</title>
    
    <!-- LIBRAIRIES EXTERNES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- FIREBASE MODULE (Authentification & Cloud) -->
    <script type="module">
        // Import des fonctions n√©cessaires
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // AJOUTS ICI : addDoc, updateDoc, arrayUnion, query, where
        import { getFirestore, doc, setDoc, getDoc, addDoc, updateDoc, arrayUnion, collection, getDocs, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURATION FIREBASE
        const firebaseConfig = {
          apiKey: "AIzaSyCKuGuHgM3FiuHYdhFunbbqCThQJSBq3tQ",
          authDomain: "green-codex-app.firebaseapp.com",
          databaseURL: "https://green-codex-app-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "green-codex-app",
          storageBucket: "green-codex-app.firebasestorage.app",
          messagingSenderId: "59967188926",
          appId: "1:59967188926:web:a8211850f8f1aa6248d3ef"
        };

        // Initialisation globale
        window.initFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                const appId = 'green_codex_default'; 
                
                // EXPOSITION DES FONCTIONS GLOBALES (Indispensable pour app.js)
                window.firebaseFuncs = { 
                    doc, setDoc, getDoc, addDoc, updateDoc, arrayUnion, 
                    collection, getDocs, deleteDoc, query, where 
                };

                return new Promise((resolve) => {
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            resolve({ db, user, appId });
                        } else {
                            signInAnonymously(auth)
                                .then((cred) => resolve({ db, user: cred.user, appId }))
                                .catch(e => resolve(null));
                        }
                    });
                });
            } catch (e) {
                console.error("Firebase Init Error", e);
                return null;
            }
        };
    </script>


    <!-- STYLES CSS -->
	
	<link rel="stylesheet" href="style.css">
	
    <!-- Fichier externe style.CSS -->
</head>
<body class="text-slate-800 pb-32">

    <!-- HEADER -->
    <header class="bg-gradient-to-r from-emerald-900 to-emerald-700 text-white p-6 shadow-lg sticky top-0 z-50 transition-colors" id="main-header">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div onclick="showView('home')" class="cursor-pointer">
                <h1 class="text-2xl md:text-3xl font-black tracking-tight" data-editable="app_title">GREEN <span class="text-emerald-300">CODEX</span></h1>
                <p class="text-xs md:text-sm text-emerald-200" data-editable="app_subtitle">Encyclop√©die Cannabique & Collection Personnel</p>
            </div>
            <div class="flex gap-2">
                <button onclick="showView('info')" class="bg-white/10 hover:bg-white/20 text-white w-10 h-10 rounded-lg text-lg font-bold transition flex items-center justify-center border border-white/20">‚ÑπÔ∏è</button>
                <button onclick="toggleEditMode()" id="editModeBtn" class="bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm font-bold transition flex items-center gap-2 border border-white/20"><span>‚úèÔ∏è</span> <span class="hidden md:inline">Mode √âdition</span></button>
                <button id="navBackBtn" onclick="showView('home')" class="hidden bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm font-bold transition backdrop-blur-sm">‚Üê Retour</button>
            </div>
        </div>
        <div id="edit-banner" class="hidden w-full bg-amber-500 text-white text-center text-xs font-bold py-1 mt-2 rounded shadow-inner">MODE √âDITION ACTIF - Cliquez sur n'importe quel texte pour le modifier.</div>
    </header>

    <!-- FIX MARGE NEGATIVE : Padding-top r√©duit √† 2 pour coller au header -->
    <main class="max-w-7xl mx-auto px-4 md:px-8 pb-8 pt-2 space-y-16">

        <!-- ==================== VIEW: HOME ==================== -->
        <div id="view-home" class="fade-in space-y-16">
            
            <!-- INTRO -->
            <section id="intro-card" class="bg-white rounded-2xl shadow-md p-8 border-l-8 border-emerald-600 relative group transition-all duration-300">
                <div class="flex items-center gap-2 mb-2 cursor-pointer" onclick="toggleSection('intro-card')">
                    <h2 class="section-title mb-0" data-editable="intro_title">L'Odyss√©e de la Plante</h2>
                </div>
                
                <!-- Partie toujours visible (Teaser) -->
                <div class="text-lg leading-relaxed text-slate-600 text-justify mb-4" data-editable="intro_teaser">
                    <p>L'histoire du <strong>Cannabis Sativa L.</strong> est une √©pop√©e botanique et culturelle qui traverse les mill√©naires.</p>
                </div>

                <!-- Partie repliable -->
                <div class="collapsible-wrapper">
                    <div class="text-lg leading-relaxed text-slate-600 space-y-4 text-justify" data-editable="intro_text">
						<p>N√©e dans les steppes d'Asie Centrale, probablement pr√®s du plateau tib√©tain, cette plante a √©t√© domestiqu√©e par l'homme il y a plus de 10 000 ans, initialement pour ses fibres robustes et ses graines nutritives.</p>
						
                        <p>Au fil des si√®cles, la plante a voyag√© le long des routes de la soie, s'adaptant √† divers climats pour donner naissance √† deux grandes lign√©es : les vari√©t√©s tropicales, √©lanc√©es et √©nergisantes (Sativa), et les vari√©t√©s de montagne, trapues et r√©sineuses (Indica). Cette diversit√© g√©n√©tique est aujourd'hui la base de milliers d'hybrides modernes.</p>
                        
                        <p>Historiquement, deux grandes traditions de consommation s'opposent et se compl√®tent. D'un c√¥t√©, la culture de la <strong>Fleur (Weed)</strong>, s√©ch√©e avec soin pour pr√©server ses ar√¥mes d√©licats. De l'autre, l'art ancestral du <strong>Hashish</strong>, perfectionn√© au Moyen-Orient et en Asie (Maroc, Afghanistan, N√©pal), qui consiste √† s√©parer m√©caniquement les trichomes pour obtenir un concentr√© pur, stable et puissant.</p>
                        
                        <p>Aujourd'hui, nous vivons une v√©ritable renaissance cannabique. La science moderne nous permet enfin de d√©crypter l'interaction subtile entre les cannabino√Ødes (THC, CBD...) et les terp√®nes (les mol√©cules aromatiques).</p>

                        <p>Cette application, le Green Codex, est con√ßue pour vous guider dans cette nouvelle √®re, vous aidant √† comprendre, archiver et appr√©cier la complexit√© de chaque produit.</p>
                    </div>
                </div>
                
                <button onclick="toggleSection('intro-card')" class="absolute bottom-2 left-2 text-emerald-600 p-2 hover:bg-emerald-50 rounded-full transition">
                    <svg class="w-6 h-6 toggle-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
            </section>

            <!-- MY COLLECTION PREVIEW -->
            <section id="my-collection-preview" class="bg-slate-900 rounded-2xl p-8 text-white relative overflow-hidden shadow-xl">
                <div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500 rounded-full blur-[80px] opacity-20 pointer-events-none"></div>
                <div class="relative z-10">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h2 class="section-title !text-white mb-2" data-editable="col_title">My Collection</h2>
                            <p class="text-slate-400" data-editable="col_sub">Votre carnet de d√©gustation</p>
                            <p class="text-xs text-slate-500 mt-1">Stockage :<span id="storage-used" class="ml-2 text-slate-400 text-[10px] uppercase font-bold tracking-wider opacity-80">(Calcul...)</span></p>
                        </div>
                        <button onclick="showView('collection')" class="bg-emerald-500 hover:bg-emerald-400 text-white px-6 py-3 rounded-xl font-bold transition shadow-lg flex items-center gap-2"><span>üìÇ</span> Ouvrir Portfolio</button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><span class="text-slate-400 text-xs uppercase font-bold">Total Entr√©es</span><div class="text-3xl font-black text-white" id="stats-total">0</div></div>
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><span class="text-slate-400 text-xs uppercase font-bold">Weeds ü•¶</span><div class="text-3xl font-black text-emerald-400" id="stats-weed">0</div></div>
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><span class="text-slate-400 text-xs uppercase font-bold">Hashs üç´</span><div class="text-3xl font-black text-amber-500" id="stats-hash">0</div></div>
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700"><span class="text-slate-400 text-xs uppercase font-bold">Masse Totale</span><div class="text-3xl font-black text-purple-400" id="stats-mass">0g</div></div>
				    </div>
                </div>
            </section>

			<!-- Cali team -->
			<section onclick="openCaliTeam()" class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 shadow-lg border border-blue-500 text-white flex items-center justify-between cursor-pointer hover:shadow-xl hover:scale-[1.02] transition relative overflow-hidden">
                <div class="absolute right-0 top-0 w-32 h-32 bg-white rounded-full blur-[50px] opacity-20 pointer-events-none"></div>
                
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-3xl shadow-inner border border-white/30">üå¥</div>
                    <div>
                        <h2 class="text-2xl font-black">üçÉ Cali Team</h2>
                        <p class="text-blue-100 text-sm font-bold opacity-90">Espace Collaboratif</p>
                    </div>
                </div>
                <div class="relative z-10 bg-white/10 p-2 rounded-full">
                    <span class="text-2xl">‚ûî</span>
                </div>
            </section>

            <!-- FAMILIES SECTION -->
            <section>
                <div class="mb-8 border-b border-slate-200 pb-4"><h2 class="section-title" data-editable="fam_title">Les Familles Fondamentales</h2><p class="text-slate-600 max-w-3xl text-justify" data-editable="fam_desc">Le march√© moderne se divise en deux grands royaumes : la fleur brute et les extractions. Chacun poss√®de ses m√©thodes, ses rituels et ses profils aromatiques distincts.</p></div>
                <h3 class="text-xl font-bold text-slate-700 mb-4 flex items-center" data-editable="fam_sub1">üß™ Concentr√©s (Hash)</h3>	
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div onclick="showDetail('hash_dry')" class="bg-white p-6 rounded-xl shadow-md border-t-4 border-amber-500 card-interactive group"><div class="flex justify-between"> <div class="text-4xl mb-4">üèúÔ∏è</div> <span class="text-xs font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded h-fit">TRADITION</span> </div>
                    <h3 class="text-xl font-bold text-slate-800 group-hover:text-amber-600">Dry Sift</h3>
                    <p class="text-sm text-slate-500 text-justify mt-2">Le tamisage √† sec traditionnel est une technique artisanale d'extraction de r√©sine. En frottant d√©licatement les fleurs s√©ch√©es sur des tamis ultra-fins, 
                            on s√©pare les trichomes de la mati√®re v√©g√©tale. On obtient ainsi un kief pur et savoureux, appr√©ci√© pour sa grande finesse.</p></div>
                    <div onclick="showDetail('hash_water')" class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-500 card-interactive group"><div class="flex justify-between"> <div class="text-4xl mb-4">‚ùÑÔ∏è</div> <span class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded h-fit">PURET√â</span> </div>
                    <h3 class="text-xl font-bold text-slate-800 group-hover:text-blue-600">Ice-O-Lator</h3>
                    <p class="text-sm text-slate-500 text-justify mt-2">L'extraction √† l'eau et glace (Solventless), utilise l'eau glac√©e pour extraire les trichomes. Le froid rend les glandes de r√©sine cassantes, facilitant 
                            leur s√©paration par agitation. Le m√©lange est ensuite filtr√© √† travers plusieurs sacs aux mailles de plus en plus serr√©es pour obtenir de l'Ice-O-Lator ou Bubble Hash.</p></div>
                    <div onclick="showDetail('hash_rosin')" class="bg-white p-6 rounded-xl shadow-md border-t-4 border-purple-500 card-interactive group"><div class="flex justify-between"> <div class="text-4xl mb-4">üî•</div> <span class="text-xs font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded h-fit">MODERNE</span> </div>
                    <h3 class="text-xl font-bold text-slate-800 group-hover:text-purple-600">Rosin</h3>
                    <p class="text-sm text-slate-500 text-justify mt-2">C'est une extraction 100 % naturelle obtenue par pression m√©canique. En appliquant simultan√©ment de la chaleur et une forte pression sur des fleurs ou du hash, 
                            on lib√®re une r√©sine pure, collante et ultra-concentr√©e, sans jamais utiliser de solvants chimiques.</p></div>
                </div>
                <h3 class="text-xl font-bold text-slate-700 mb-4 flex items-center" data-editable="fam_sub2">üå± Fleur (Weed)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div onclick="showDetail('weed_indica')" class="bg-white p-6 rounded-xl shadow-md border-t-4 border-indigo-500 card-interactive group"><div class="flex justify-between"> <div class="text-4xl mb-4">üèîÔ∏è</div> <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded h-fit">RELAX</span> </div>
                    <h3 class="text-xl font-bold text-slate-800 group-hover:text-indigo-600">Indica</h3>
                    <p class="text-sm text-slate-500 text-justify mt-2">C'est une vari√©t√© de cannabis originaire des r√©gions montagneuses comme l'Hindou Kouch. Petite et trapue, elle se reconna√Æt √† ses feuilles larges et sombres. 
                            Elle est r√©put√©e pour ses effets relaxants et corporels ("stone"), id√©aux pour apaiser le stress ou favoriser le sommeil.</p></div>
                    <div onclick="showDetail('weed_sativa')" class="bg-white p-6 rounded-xl shadow-md border-t-4 border-yellow-500 card-interactive group"><div class="flex justify-between"> <div class="text-4xl mb-4">‚òÄÔ∏è</div> <span class="text-xs font-bold text-yellow-600 bg-yellow-50 px-2 py-1 rounded h-fit">√âNERGIE</span> </div>
                    <h3 class="text-xl font-bold text-slate-800 group-hover:text-yellow-600">Sativa</h3>
                    <p class="text-sm text-slate-500 text-justify mt-2">C'est une vari√©t√© originaire des r√©gions tropicales. Grande et √©lanc√©e, elle poss√®de des feuilles fines et des cycles de floraison longs. Elle est recherch√©e 
                            pour ses effets stimulants et c√©r√©braux ("high"), favorisant la cr√©ativit√©, l'√©nergie et la concentration.</p></div>
                    <div onclick="showDetail('weed_exotic')" class="bg-white p-6 rounded-xl shadow-md border-t-4 border-pink-500 card-interactive group"><div class="flex justify-between"> <div class="text-4xl mb-4">üß¨</div> <span class="text-xs font-bold text-pink-600 bg-pink-50 px-2 py-1 rounded h-fit">HYBRIDE</span> </div>
                    <h3 class="text-xl font-bold text-slate-800 group-hover:text-pink-600">Exotics</h3>
                    <p class="text-sm text-slate-500 text-justify mt-2">Elle d√©signe des vari√©t√©s de cannabis haut de gamme, souvent issues de croisements complexes aux √âtats-Unis. Elles se distinguent par des couleurs vibrantes, 
                            des ar√¥mes intenses et uniques, ainsi qu'une puissance √©lev√©e. C'est le segment ¬´ luxe ¬ª du march√©, privil√©giant la qualit√© visuelle et gustative</p></div>
                </div>
            </section>

            <!-- POTENCY -->
            <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg"><h2 class="section-title" data-editable="potency_title">√âchelle de Puissance</h2>
                <p class="text-slate-600 mb-4 text-sm text-justify" data-editable="potency_desc">Comparatif des taux moyens de THC observ√©s en laboratoire.</p><div class="chart-container"><canvas id="potencyChart"></canvas></div></div>
                <div class="lg:col-span-1 bg-emerald-50 border-l-4 border-emerald-500 p-6 rounded-r-xl">
                <h4 class="font-bold text-emerald-900 text-lg mb-2" data-editable="didyouknow_title">Le Mythe du THC</h4>
                <p class="text-sm text-emerald-800 leading-relaxed text-justify" data-editable="didyouknow_text">Attention : un taux de THC √©lev√© (80%+) ne garantit pas une exp√©rience "meilleure". C'est l'<strong>Effet d'Entourage</strong> qui compte : la synergie complexe entre les cannabino√Ødes et les terp√®nes.</p>
                <p class="text-sm text-emerald-800 leading-relaxed text-justify mt-4" data-editable="didyouknow_text">Par exemple, le <strong>Myrc√®ne</strong> (dominant dans la OG Kush ou un Hash Afghan) ancre la relaxation physique, tandis que le <strong>Limon√®ne</strong> (typique de la Super Lemon Haze) booste l'√©nergie et l'humeur. Le <strong>Caryophyll√®ne</strong> (Girl Scout Cookies) apporte, lui, un apaisement anti-stress. Cette synergie cr√©e une exp√©rience bien plus riche et nuanc√©e que la puissance brute isol√©e.</p></div>
            </section>

            <!-- COMPARATOR & MATRIX -->
            <section class="bg-white p-8 rounded-2xl shadow-xl border border-slate-100"><h2 class="section-title" data-editable="comp_title">Comparateur Interactif</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="space-y-6 flex flex-col justify-center bg-slate-50 p-6 rounded-xl"><div><label class="block text-sm font-bold text-slate-700 mb-2">Produit A</label><select id="selectA" class="w-full p-3 rounded border border-slate-300 bg-white outline-none" onchange="updateComparator()"></select></div><div><label class="block text-sm font-bold text-slate-700 mb-2">Produit B</label><select id="selectB" class="w-full p-3 rounded border border-slate-300 bg-white outline-none" onchange="updateComparator()"></select></div></div><div class="md:col-span-2"><div class="chart-container"><canvas id="comparatorRadar"></canvas></div></div></div></section>
            <section class="bg-white p-6 rounded-xl shadow-md"><h2 class="section-title" data-editable="matrix_title">Texture vs Puret√©</h2><div id="globalMatrixPlot" class="w-full h-[500px]"></div></section>

            <!-- LEXICON -->
            <section class="bg-slate-900 text-slate-300 p-8 rounded-xl">
                <h2 class="section-title !text-white" data-editable="lex_title">Lexique du Connaisseur</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 text-sm text-justify">
                    <div><strong class="block text-emerald-400 mb-1">Trichomes</strong><span data-editable="lex_1">Ce sont des glandes r√©sineuses microscopiques en forme de champignon qui recouvrent la fleur. C'est l'usine chimique de la plante.</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Terp√®nes</strong><span data-editable="lex_2">Des compos√©s aromatiques volatils (Limon√®ne, Pin√®ne...). Ils d√©finissent l'odeur et orientent l'effet (s√©datif ou stimulant).</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Full Melt</strong><span data-editable="lex_3">C'est un gage de puret√© extr√™me pour un hash (souvent Water Hash) qui fond totalement √† la chaleur sans laisser aucun r√©sidu (6 √©toiles).</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Solventless</strong><span data-editable="lex_4">C'est une m√©thodes d'extraction m√©caniques utilisant uniquement l'eau, la glace, la chaleur et la pression. Il n'y a aucune chimie.</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Fresh Frozen</strong><span data-editable="lex_5">Technique consistant √† surgeler la mati√®re v√©g√©tale (fleurs ou simple manucure) imm√©diatement apr√®s la r√©colte, sans s√©chage, pour figer les terp√®nes volatils avant toute oxydation. C'est la base des produits dits "Live".</span></div>
                    <div><strong class="block text-emerald-400 mb-1">WPFF (Whole Plant)</strong><span data-editable="lex_6">Acronyme de "Whole Plant Fresh Frozen". D√©signe le summum de la qualit√© : contrairement au Fresh Frozen standard, on cong√®le ici la plante enti√®re (avec ses meilleures fleurs) et non juste les restes de taille.</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Curing</strong><span data-editable="lex_7">C'est un processus d'affinage lent en bocal herm√©tique. Il est crucial pour stabiliser l'humidit√© et d√©velopper la complexit√© aromatique.</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Pheno Hunting</strong><span data-editable="lex_8">Designe l'art de s√©lectionner la meilleure plante (le meilleur ph√©notype) parmi des centaines de graines d'une m√™me vari√©t√©.</span></div>
                    <div><strong class="block text-emerald-400 mb-1">Wash</strong><span data-editable="lex_9">C'est l'action de laver la mati√®re v√©g√©tale dans de l'eau glac√©e pour en d√©tacher les trichomes (pour faire du Bubble Hash).</span></div>
                </div>
            </section>

            <!-- DYNAMIC SECTIONS -->
            <div id="custom-sections-container" class="space-y-16"></div>
            
            <!-- ADD SECTION BUTTON -->
            <div id="add-section-area" class="hidden text-center py-10 border-t-2 border-dashed border-slate-300 mt-12">
                <p class="text-slate-400 mb-4 text-sm font-bold uppercase tracking-widest">Zone de Personnalisation</p>
                <button onclick="openSectionModal()" class="bg-amber-500 hover:bg-amber-600 text-white px-8 py-4 rounded-full font-bold shadow-lg transition transform hover:scale-105 mx-auto">
                    + Ajouter une Section
                </button>
            </div>
        </div>

        <!-- ==================== VIEW: DETAIL ==================== -->
        <div id="view-detail" class="hidden fade-in space-y-8 pb-12">
            <div id="detail-header" class="bg-white p-8 rounded-2xl shadow-lg border-t-8">
                <div class="flex justify-between items-center mb-6"><div><span id="detail-badge" class="px-3 py-1 rounded-full text-sm font-bold uppercase tracking-wider mb-2 inline-block">Badge</span><h2 id="detail-title" class="text-4xl md:text-5xl font-black text-slate-800">Title</h2></div><div class="text-5xl opacity-20" id="detail-icon">icon</div></div><p id="detail-desc" class="text-lg text-slate-600 leading-relaxed border-l-4 border-slate-200 pl-4 text-justify">Desc</p>
            </div>
            <section class="bg-slate-800 text-white p-8 rounded-2xl shadow-xl"><h3 class="text-2xl font-bold mb-6">Processus</h3><div id="detail-flow" class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center"></div></section>
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-md"><div class="chart-container"><canvas id="detailRadarChart"></canvas></div></div><div class="bg-white p-6 rounded-xl shadow-md"><div class="chart-container"><canvas id="detailBarChart"></canvas></div></div></section>
        </div>

        <!-- ==================== VIEW: COLLECTION ==================== -->
        <div id="view-collection" class="hidden fade-in pb-20">
            <!-- BARRE AMIS CORRIG√âE (MARGE N√âGATIVE ET BACKGROUND BLANC) -->
            <div class="-mt-4 -mx-4 md:-mt-8 md:-mx-8 mb-6 flex items-center justify-between border-b border-slate-200 pb-4 bg-white p-4 shadow-sm md:rounded-b-xl z-20 relative">
                <span class="text-xs font-bold text-emerald-500 uppercase tracking-widest flex items-center gap-2"><span>üë•</span> Collaboratif</span>
                <div id="friends-list" class="flex items-center gap-2">
                    <div onclick="promptAddFriend()" class="friend-avatar add-btn" title="Ajouter un ami">+</div>
                </div>
            </div>

            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-emerald-900">Mon Portfolio</h2>
                <button onclick="openCollectionForm()" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold shadow-md hover:bg-emerald-500 transition flex items-center gap-2">+ Ajouter</button>
            </div>
            <div id="loading-indicator" class="hidden text-center py-10 text-slate-500 font-bold">Chargement des archives...</div>
            <div id="collection-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            <div id="empty-state" class="hidden text-center py-20 text-slate-400"><div class="text-6xl mb-4">üì≠</div><p>Votre collection est vide.</p></div>
        </div>

        <!-- ==================== VIEW: FRIEND PORTFOLIO ==================== -->
		<div id="view-friend" class="hidden fade-in pb-20">
		    <div class="-mt-4 -mx-4 md:-mt-8 md:-mx-8 bg-blue-600 text-white p-6 shadow-lg mb-6 md:rounded-b-2xl relative">
		        <button onclick="showView('collection')" class="absolute top-6 right-6 text-blue-200 hover:text-white font-bold text-sm">Fermer ‚úï</button>
		        <h2 class="text-3xl font-bold mb-2">Portfolio de <span id="friend-view-name">Ami</span></h2>
		        <p class="text-blue-200 text-sm">Mode lecture seule.</p>
		    </div>
		            
		    <div id="friend-collection-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
		    <div id="friend-empty-state" class="hidden text-center py-20 text-slate-400"><div class="text-6xl mb-4">üîí</div><p>Aucune entr√©e visible ou portefeuille priv√©.</p></div>
		            
		    <div class="mt-12 mb-8 text-center border-t border-slate-100 pt-8">
		        <button onclick="deleteCurrentFriend()" class="text-red-500 font-bold border border-red-200 px-6 py-3 rounded-xl hover:bg-red-50 transition flex items-center gap-2 mx-auto">
		            <span>üóëÔ∏è</span> Retirer cet ami de ma liste
		        </button>
		    </div>
		</div>

        <!-- ==================== VIEW: INFO ==================== -->
        <div id="view-info" class="hidden fade-in space-y-8">
            <div class="bg-white p-6 rounded-2xl shadow-lg border-l-8 border-emerald-600">
                <h2 class="text-2xl font-black text-slate-800 mb-6 flex items-center gap-3">‚ÑπÔ∏è Informations & Tuto</h2>
                
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100 relative mb-8">
                    <!-- ID Display -->
                    <div class="text-center mb-6">
                        <p class="text-[10px] uppercase text-emerald-600 mb-1 font-bold tracking-widest">Mon ID Unique</p>
                        <div class="font-mono text-sm text-slate-600 bg-slate-100 p-2 rounded border border-slate-200 truncate max-w-[250px] mx-auto select-all mb-2" id="my-uid-display">
                            Connexion au Cloud...
                        </div>
                        <div class="flex justify-center gap-3">
                            <button id="btn-copy-id" onclick="copyToClipboard()" class="bg-white border border-slate-300 text-slate-600 px-3 py-1 rounded-lg text-xs font-bold shadow-sm hover:bg-slate-50 flex items-center gap-1 transition-all">üìã Copier</button>
                            <button onclick="shareId()" class="bg-emerald-600 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-sm hover:bg-emerald-500 flex items-center gap-1 transition-all">üì§ Partager</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 border-t border-emerald-200 pt-4">
                        <div class="border-r border-emerald-200 pr-2">
                            <h3 class="text-[10px] font-bold text-emerald-700 uppercase tracking-widest mb-1">Install√©e (Local)</h3>
                            <div class="font-mono text-xs font-bold text-slate-700 break-all" id="info-local-hash">-</div>
                            <p class="text-[10px] text-emerald-500 mt-1" id="info-local-date">Date inconnue</p>
                        </div>
                        <div class="pl-2 text-right">
                             <div class="flex items-center justify-end gap-2 mb-1">
                                <span class="text-[10px] font-bold text-emerald-700 uppercase">Disponible (GitHub)</span>
                                <div id="connection-status" class="w-2 h-2 rounded-full bg-gray-400"></div>
                            </div>
                            <div class="font-mono text-xs font-bold text-emerald-600 break-all" id="info-remote-hash">...</div>
                        </div>
                    </div>
                    <button onclick="verifyUpdate(this)" class="mt-4 w-full bg-emerald-600 text-white font-bold py-2 rounded-lg hover:bg-emerald-500 transition text-sm flex justify-center items-center gap-2"><span>üîÑ</span> V√©rifier maintenant</button>
                    
                    <!-- ZONE SECURITE (BACKUP/RESTORE) -->
                    <div class="mt-4 pt-4 border-t border-emerald-200">
                        <p class="text-[10px] uppercase text-emerald-600 mb-2 font-bold tracking-widest text-center">Zone de S√©curit√©</p>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="exportBackup()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-lg text-xs shadow-sm flex items-center justify-center gap-1 transition-colors">
                                <span>üíæ</span> Sauvegarder (JSON)
                            </button>
                            <label class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-2 px-3 rounded-lg text-xs shadow-sm flex items-center justify-center gap-1 transition-colors cursor-pointer">
                                <span>üìÇ</span> Restaurer (JSON)
                                <input type="file" accept=".json" class="hidden" onchange="importBackup(this)">
                            </label>
                        </div>
                    </div>
                </div>

                <!-- STOCKAGE -->
                <div class="bg-slate-50 border border-slate-200 p-4 rounded-xl relative shadow-sm mb-4">
                    <h3 class="font-bold text-slate-800 text-sm flex items-center gap-2 mb-2">üíæ √âtat du Stockage Local</h3>
                    <div class="flex justify-between items-end">
                        <div class="text-xs text-slate-500">
                            Donn√©es (Photos HD + Textes) <br>stock√©es s√©curis√©es dans IndexedDB.
                        </div>
                        <div class="text-xl font-black text-emerald-600" id="info-storage-size">Calcul...</div>
                    </div>
                </div>

                <!-- README -->
                <div id="readme-card" class="bg-white border border-slate-200 p-4 rounded-xl relative shadow-sm transition-all duration-300">
                    <div class="cursor-pointer flex items-center gap-2 mb-0" onclick="toggleSection('readme-card')"><span class="text-2xl">üí°</span><h3 class="font-bold text-slate-800 text-lg">√Ä propos de Green Codex</h3></div>
                    <div class="collapsible-wrapper">
                        <div class="text-sm text-slate-600 text-justify leading-relaxed mt-4 mb-4 border-t border-slate-100 pt-4">
                            <p class="mb-2"><strong>Green Codex</strong> n'est pas une simple application de notes, c'est votre compagnon d'exploration cannabique. Elle a √©t√© con√ßue pour combler le foss√© entre la science botanique et l'exp√©rience utilisateur.</p>
                            <p class="mb-2">Son but est double :</p>
                            <ul class="list-disc pl-5 mb-4 space-y-1">
                                <li><strong>√âduquer :</strong> En fournissant des fiches techniques pr√©cises sur les familles de plantes (Indica, Sativa) et les m√©thodes d'extraction (Hash), visualisables via des graphiques interactifs.</li>
                                <li><strong>Archiver :</strong> En vous offrant un espace priv√© ("Mon Portfolio") pour cataloguer vos d√©couvertes, noter vos impressions, ajouter des photos et suivre l'√©volution de vos go√ªts au fil du temps.</li>
                                <li><strong>Partager :</strong> En vous permettant de voir le portfolio de vos amis. Montrerez leur vos meilleurs d√©couvertes en partageant le votre. Partager leur votre ID et ils auront acc√®s √† votre portfolio (seulement les textes pas les photos).</li>
                            </ul>
                            <p>Connect√©e en permanence √† GitHub, l'application √©volue sans cesse tout en garantissant que vos donn√©es personnelles restent stock√©es localement sur votre appareil (via IndexedDB), en toute s√©curit√©.</p>
                        </div>
                        <button onclick="openTutorial()" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-xl shadow-md transition text-sm w-full flex justify-center items-center gap-2">üéì Lancer le Tutoriel Interactif</button>
                    </div>
                    <button onclick="toggleSection('readme-card')" class="absolute bottom-2 left-2 text-slate-400 p-2 hover:bg-slate-100 rounded-full transition"><svg class="w-6 h-6 toggle-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                </div>
            </div>
        </div>

		<!-- Accueil du groupe (les 4 bulles) -->
		<div id="view-cali-hub" class="hidden fade-in pb-20">
            <div class="mb-8 flex items-center gap-4">
                <button onclick="showView('home')" class="bg-slate-100 p-3 rounded-full hover:bg-slate-200 transition">üè†</button>
                <div>
                    <h2 class="text-3xl font-black text-slate-800">Cali Team üå¥</h2>
                    <p class="text-slate-500 font-bold">Tableau de bord</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div onclick="showView('cali-friends')" class="bubble-card bg-indigo-50 text-indigo-700 border-indigo-100">
                    <span class="bubble-icon">üë•</span>
                    <span class="bubble-title">Amis</span>
                    <span class="text-xs mt-1 opacity-70">G√©rer l'√©quipe</span>
                </div>
                <div onclick="showView('cali-spots')" class="bubble-card bg-emerald-50 text-emerald-700 border-emerald-100">
                    <span class="bubble-icon">üìç</span>
                    <span class="bubble-title">Spots</span>
                    <span class="text-xs mt-1 opacity-70">Lieux &amp; Chill</span>
                </div>
                <div onclick="showView('cali-wishlist')" class="bubble-card bg-purple-50 text-purple-700 border-purple-100">
                    <span class="bubble-icon">üßû</span>
                    <span class="bubble-title">Wishlist</span>
                    <span class="text-xs mt-1 opacity-70">√Ä chasser</span>
                </div>
				<div onclick="showView('cali-games')" class="bubble-card bg-orange-50 text-orange-700 border-orange-100">
                    <span class="bubble-icon">üéÆ</span>
                    <span class="bubble-title">Jeux</span>
                    <span class="text-xs mt-1 opacity-70">Arcade Multi</span>
                </div>
            </div>
        </div>

        <div id="view-cali-friends" class="hidden fade-in pb-20">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="showView('cali-hub')" class="bg-indigo-100 text-indigo-600 p-2 rounded-full">‚¨ÖÔ∏è</button>
                <h2 class="text-2xl font-bold text-indigo-900">Membres</h2>
            </div>
            <div id="cali-members-list" class="space-y-3">Chargement...</div>
            <button onclick="addMemberToCali()" class="mt-6 w-full py-4 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-500 transition">+ Ajouter un membre par ID</button>
        </div>

        <div id="view-cali-spots" class="hidden fade-in pb-20">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <button onclick="showView('cali-hub')" class="bg-emerald-100 text-emerald-600 p-2 rounded-full">‚¨ÖÔ∏è</button>
                    <h2 class="text-2xl font-bold text-emerald-900">Spots</h2>
                </div>
                <button onclick="openSpotForm('spot')" class="bg-emerald-600 text-white w-12 h-12 rounded-full font-bold shadow-lg text-xl flex items-center justify-center">+</button>
            </div>
            
            <div class="flex gap-2 overflow-x-auto pb-2 mb-4 no-scrollbar">
                <button onclick="filterSpots('all')" class="px-4 py-1 bg-slate-800 text-white rounded-full text-xs font-bold whitespace-nowrap">Tout</button>
                <button onclick="filterSpots('chill')" class="px-4 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-bold whitespace-nowrap">üçÉ Chill</button>
                <button onclick="filterSpots('vue')" class="px-4 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-bold whitespace-nowrap">üëÄ Vue</button>
            </div>

            <div id="cali-spots-list" class="space-y-4"></div>
        </div>

        <div id="view-cali-wishlist" class="hidden fade-in pb-20">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <button onclick="showView('cali-hub')" class="bg-purple-100 text-purple-600 p-2 rounded-full">‚¨ÖÔ∏è</button>
                    <h2 class="text-2xl font-bold text-purple-900">Wishlist</h2>
                </div>
                <button onclick="openWishModal()" class="bg-purple-600 text-white w-12 h-12 rounded-full font-bold shadow-lg text-xl flex items-center justify-center">+</button>
            </div>
            <div id="cali-wishlist-list" class="space-y-3"></div>
        </div>

		<div id="view-cali-games" class="hidden fade-in pb-20">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="showView('cali-hub')" class="bg-orange-100 text-orange-600 p-2 rounded-full">‚¨ÖÔ∏è</button>
                <h2 class="text-2xl font-bold text-orange-900">Arcade Team üéÆ</h2>
            </div>

            <div class="bg-white border-2 border-orange-100 p-6 rounded-2xl text-center mb-8 shadow-sm relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-orange-100 rounded-full blur-[30px] opacity-50 -mr-4 -mt-4"></div>
                <p class="text-slate-400 text-xs font-bold uppercase mb-2">Mon Statut</p>
                <h3 id="my-game-status" class="text-lg font-black text-slate-300 mb-4">Inactif</h3>
                <button onclick="quitGameLobby()" class="text-orange-500 text-xs font-bold underline hover:text-orange-700">Je ne joue plus</button>
            </div>

            <div class="mb-8">
                <h3 class="font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> En salle d'attente
                </h3>
                <div id="cali-active-players" class="space-y-2">
                    </div>
            </div>

            <h3 class="font-bold text-slate-700 mb-4">Choisissez un jeu :</h3>
            <div id="cali-games-list" class="grid grid-cols-3 gap-3">
                </div>
        </div>

    </main>

    <!-- UPDATE MODULE -->
    <div id="updateContainer"><div id="updateAlert"><span class="update-text">Mise √† jour üöÄ</span><span class="arrow-pointer">‚ûú</span></div><button id="refreshBtn" onclick="forceUpdate()"><div class="update-dot" id="updateDot"></div>&#x21bb;</button></div>
    <!-- WHATS NEW MODULE -->
    <div id="wn-overlay"><div id="wn-modal"><div class="wn-header"><span id="wn-badge-text" class="wn-badge">Mise √† jour d√©tect√©e</span><h2 id="wn-main-title" class="wn-title">Quoi de neuf ?</h2></div><div id="wn-content" class="wn-slides-container"><div class="wn-loader"></div></div><div id="wn-dots" class="wn-dots"></div><button id="wn-btn" onclick="nextSlide()" style="display:none">Suivant ‚ûú</button></div></div>

    <!-- MODAL: COLLECTION FORM -->
    <div id="collection-modal" class="hidden fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
            <h3 id="modal-title" class="text-2xl font-bold text-slate-800 mb-6">Ajouter √† la collection</h3>
            <form id="collection-form" onsubmit="handleCollectionSubmit(event)" class="space-y-4">
                <input type="hidden" name="editId" id="editId" value="">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Cat√©gorie</label><select name="category" id="inp-category" class="input-field" onchange="toggleFormFields(this.value)"><option value="weed">ü•¶ Weed</option><option value="hash">üç´ Hash</option></select></div>
                    <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Quantit√© (g)</label><input type="number" step="0.1" name="quantity" id="inp-quantity" class="input-field" placeholder="ex: 3.5"></div>
                </div>
                <div id="hash-fields" class="hidden bg-amber-50 p-3 rounded-lg border border-amber-100 mb-2"><label class="text-xs font-bold text-amber-600 uppercase mb-1">Type de Hash</label><input type="text" name="hashType" id="inp-hashType" class="input-field border-amber-200" placeholder="ex: Dry Sift..."></div>
                <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Vari√©t√© (Strain)</label><input type="text" name="strain" id="inp-strain" class="input-field font-bold" placeholder="ex: Gelato #41" required></div>
                <!-- FARM INPUT ADDED HERE -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Nom Commercial</label><input type="text" name="commercialName" id="inp-commercialName" class="input-field" placeholder="ex: Blue Magic"></div>
                    <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Farm / Producteur</label><input type="text" name="farm" id="inp-farm" class="input-field" placeholder="ex: The Ten Co"></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Pays</label><input type="text" name="country" id="inp-country" class="input-field" placeholder="ex: Pays-Bas"></div>
                    <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Prix (‚Ç¨)</label><input type="number" name="price" id="inp-price" class="input-field" placeholder="ex: 50"></div>
                </div>
                <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Date d'ajout</label><input type="date" name="date" id="inp-date" class="input-field"></div>
                <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Observations</label><textarea name="observation" id="inp-observation" class="input-field" placeholder="Effets, saveurs, notes personnelles..." rows="3"></textarea></div>
                <div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Photos (HD Illimit√©)</label><div class="flex gap-2 items-center"><label class="w-20 h-20 border-2 border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-slate-50 transition text-slate-400"><span class="text-2xl">+</span><input type="file" id="photo-input" class="hidden" accept="image/*" multiple onchange="handlePhotos(this)"></label><div id="photo-preview-list" class="flex gap-2 overflow-x-auto"></div></div></div>
                <div class="flex gap-3 pt-4"><button type="button" onclick="closeCollectionForm()" class="flex-1 py-3 rounded-xl border border-slate-300 text-slate-500 font-bold">Annuler</button><button type="submit" class="flex-1 py-3 rounded-xl bg-emerald-600 text-white font-bold hover:bg-emerald-500">Sauvegarder</button></div>
            </form>
        </div>
    </div>

    <!-- MODAL: SECTION ADD -->
    <div id="section-modal" class="hidden fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"><div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl p-6"><h3 class="text-2xl font-bold text-slate-800 mb-6" id="section-modal-title">Ajouter une Section</h3><form id="section-form" onsubmit="handleSectionSubmit(event)" class="space-y-4"><input type="hidden" name="secId" id="sec-id"><div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Titre</label><input type="text" name="secTitle" id="sec-title" class="input-field font-bold" required></div><div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Contenu</label><textarea name="secText" id="sec-text" class="input-field" required></textarea></div><div class="space-y-1"><label class="text-xs font-bold text-slate-500 uppercase">Image</label><input type="file" id="sec-photo-input" class="input-field" accept="image/*"><div id="sec-current-image" class="mt-2 hidden"><img src="" class="h-20 rounded border"></div></div><div class="flex gap-3 pt-4"><button type="button" onclick="closeSectionModal()" class="flex-1 py-3 rounded-xl border border-slate-300 text-slate-500 font-bold">Annuler</button><button type="submit" class="flex-1 py-3 rounded-xl bg-amber-500 text-white font-bold hover:bg-amber-600">Enregistrer</button></div></form></div></div>

    <!-- MODAL: COLLECTION DETAIL -->
    <div id="collection-detail-modal" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col animate-fade-in">
            <div id="cd-img-container" class="w-full h-64 bg-slate-900 relative flex-shrink-0 group"><img id="cd-main-img" class="w-full h-full object-contain"><button onclick="closeCollectionDetail()" class="absolute top-4 right-4 bg-white/20 text-white rounded-full p-2 hover:bg-white/40 backdrop-blur-sm transition">‚úï</button><div id="cd-thumbs" class="absolute bottom-4 left-0 right-0 flex justify-center gap-2 px-4 overflow-x-auto z-10"></div></div>
            <div class="p-6 overflow-y-auto">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 id="cd-strain" class="text-3xl font-black text-slate-800 leading-tight">Strain</h2>
                        <p class="text-emerald-600 font-bold uppercase text-sm tracking-wider mt-1">
                            <span id="cd-commercial">Commercial</span>
                            <span id="cd-hash-badge" class="hidden ml-2 bg-amber-100 text-amber-700 px-2 py-0.5 rounded text-xs border border-amber-200"></span>
                        </p>
                    </div>
                    <div class="text-5xl" id="cd-flag">üè≥Ô∏è</div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6"><div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Quantit√©</span><span id="cd-quantity" class="text-xl font-black text-slate-700">0g</span></div><div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Prix</span><span id="cd-price" class="text-xl font-black text-slate-700">0‚Ç¨</span></div><div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Type</span><span id="cd-category" class="text-lg font-bold text-slate-700">Weed</span></div><div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Date</span><span id="cd-date" class="text-sm font-bold text-slate-700">...</span></div></div>
                <div id="cd-observation-container" class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-6 hidden"><h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Observations</h4><p id="cd-observation" class="text-sm text-slate-700 italic text-justify"></p></div>
                
                <div class="space-y-3 text-sm text-slate-600 mb-8 bg-white rounded-xl">
                    <div class="flex justify-between border-b border-slate-100 pb-2">
                        <span>Producteur / Farm</span>
                        <span id="cd-farm" class="font-bold text-slate-800">Unknown</span>
                    </div>
                    <!-- REMOVED OTHER ROWS -->
                </div>
                
                <div class="flex gap-3"><button id="cd-btn-edit" class="flex-1 py-3 rounded-xl border border-blue-200 text-blue-600 font-bold hover:bg-blue-50 transition">Modifier</button><button id="cd-btn-delete" class="flex-1 py-3 rounded-xl border border-red-200 text-red-500 font-bold hover:bg-red-50 transition">Supprimer</button></div></div>
        </div>
    </div>

    <!-- MODAL: FRIEND DETAIL -->
    <div id="friend-detail-modal" class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col animate-fade-in">
            <div class="w-full h-32 bg-blue-600 relative flex-shrink-0 group flex items-center justify-center">
                <span class="text-6xl">üë§</span>
                <button onclick="closeFriendDetail()" class="absolute top-4 right-4 bg-white/20 text-white rounded-full p-2 hover:bg-white/40 backdrop-blur-sm transition">‚úï</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 id="fd-strain" class="text-3xl font-black text-slate-800 leading-tight">Strain</h2>
                        <p class="text-emerald-600 font-bold uppercase text-sm tracking-wider mt-1">
                            <span id="fd-commercial">Commercial</span>
                            <span id="fd-hash-badge" class="hidden ml-2 bg-amber-100 text-amber-700 px-2 py-0.5 rounded text-xs border border-amber-200"></span>
                        </p>
                    </div>
                    <div class="text-5xl" id="fd-flag">üè≥Ô∏è</div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Quantit√©</span><span id="fd-quantity" class="text-xl font-black text-slate-700">0g</span></div>
                    <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Prix</span><span id="fd-price" class="text-xl font-black text-slate-700">0‚Ç¨</span></div>
                    <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Type</span><span id="fd-category" class="text-lg font-bold text-slate-700">Weed</span></div>
                    <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center"><span class="text-[10px] uppercase text-slate-400 font-bold block">Date</span><span id="fd-date" class="text-sm font-bold text-slate-700">...</span></div>
                </div>
                <!-- AJOUT DETAIL OBSERVATION -->
                <div id="fd-observation-container" class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-6 hidden">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Observations</h4>
                    <p id="fd-observation" class="text-sm text-slate-700 italic text-justify"></p>
                </div>

                <div class="space-y-3 text-sm text-slate-600 mb-8 bg-white rounded-xl">
                     <div class="flex justify-between border-b border-slate-100 pb-2">
                        <span>Producteur / Farm</span>
                        <span id="fd-farm" class="font-bold text-slate-800">Unknown</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

	<!-- MODAL Bulle "Spots"-->
	<div id="cali-spot-modal" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
	        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl p-6">
	            <h3 id="csm-title" class="text-2xl font-bold text-slate-800 mb-4">Nouveau Lieu</h3>
	            <form onsubmit="handleCaliSpotSubmit(event)" class="space-y-4">
	                
	                <input type="hidden" id="spot-id-input">
	                
	                <input type="hidden" id="csm-type"> 
	                
	                <div class="grid grid-cols-4 gap-4">
	                    <div class="col-span-1"><label class="text-[10px] font-bold uppercase text-slate-400">Emoji</label><input type="text" id="csm-emoji" class="input-field text-center text-2xl" placeholder="üìç" required></div>
	                    <div class="col-span-3"><label class="text-[10px] font-bold uppercase text-slate-400">Nom</label><input type="text" id="csm-name" class="input-field font-bold" placeholder="Le Spot Cach√©" required></div>
	                </div>
	
	                <div><label class="text-[10px] font-bold uppercase text-slate-400">Lien Google Maps (Extraction Auto GPS)</label><input type="text" id="csm-link" class="input-field text-blue-600 text-xs" onchange="parseMapsLink(this.value)" placeholder="Collez le lien ici..."></div>
	
	                <div class="grid grid-cols-2 gap-4 bg-slate-50 p-2 rounded border border-slate-100">
	                    <div><label class="text-[10px] font-bold uppercase text-slate-400">Lat</label><input type="text" id="csm-lat" class="input-field text-xs bg-white" readonly></div>
	                    <div><label class="text-[10px] font-bold uppercase text-slate-400">Lon</label><input type="text" id="csm-lon" class="input-field text-xs bg-white" readonly></div>
	                </div>
	
	                <div class="grid grid-cols-2 gap-4">
	                    <div><label class="text-[10px] font-bold uppercase text-slate-400">Ville / Zone</label><input type="text" id="csm-city" class="input-field" placeholder="Ex: Centre-Ville"></div>
	                    <div>
	                        <label class="text-[10px] font-bold uppercase text-slate-400">Cat√©gorie</label>
	                        <select id="csm-cat" class="input-field">
	                            <option value="Chill">üçÉ Chill</option>
	                            <option value="Vue">üëÄ Vue</option>
	                            <option value="Eau">üíß Eau</option>
	                            <option value="Abri">‚òî Abri</option>
	                            <option value="Autre">‚ö™ Autre</option>
	                        </select>
	                    </div>
	                </div>
	
	                <div><label class="text-[10px] font-bold uppercase text-slate-400">Observations</label><textarea id="csm-desc" class="input-field h-20" placeholder="Infos pratiques..."></textarea></div>
	
	                <div class="flex gap-3 pt-2">
	                    <button type="button" onclick="document.getElementById('cali-spot-modal').classList.add('hidden')" class="flex-1 py-3 border border-slate-300 rounded-xl text-slate-500 font-bold">Annuler</button>
	                    <button type="submit" class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-500">Sauvegarder</button>
	                </div>
	            </form>
	        </div>
	    </div>

        <!-- MODAL Wishlist -->
        <div id="wish-modal" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-4">Ajouter une envie üßû</h3>
                <form onsubmit="handleWishSubmit(event)" class="space-y-4">
                    <input type="hidden" id="wish-id-input">
                    <div>
                        <label class="text-[10px] font-bold uppercase text-slate-400">Votre id√©e (Texte, Lien, Emoji...)</label>
                        <textarea id="wish-text" class="input-field h-32 text-lg" placeholder="Ex: Go√ªter la Blue Dream du coffeeshop X..." required></textarea>
                    </div>
                    <div class="flex gap-3 pt-2">
                        <button type="button" onclick="document.getElementById('wish-modal').classList.add('hidden')" class="flex-1 py-3 border border-slate-300 rounded-xl text-slate-500 font-bold">Annuler</button>
                        <button type="submit" class="flex-1 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-500">Ajouter</button>
                    </div>
                </form>
            </div>
        </div>

	<!-- Le script est dans le fichier app.js -->

	<script src="app.js"></script>

	<!-- script -->
        
</body>
</html>
